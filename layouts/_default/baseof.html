<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "en" }}">
<head>
    <meta charset="UTF-8">
    <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/oGJIdQ0.png" alt="Site Icon">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    <meta name="author" content="{{ .Site.Params.author }}">
    <meta name="robots" content="index,follow">
    <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
    <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ .Permalink }}">

    {{ with .OutputFormats.Get "RSS" }}
    <link rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }} RSS Feed" href="{{ .RelPermalink }}" />
    {{ end }}

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;300;400;500;600;700;900&display=swap" rel="stylesheet">

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    {{ $style := resources.Get "css/terminal.css" }}
    {{ if $style }}
    <link rel="stylesheet" href="{{ $style.Permalink }}">
    {{ end }}
    {{ block "head" . }}{{ end }}
</head>
<body>
    <!-- Matrix Rain Background Canvas -->
    <canvas id="matrix-canvas"></canvas>

    <header class="header">
        <a href="{{ .Site.BaseURL }}" class="blog-title">{{ .Site.Title }}</a>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search..." id="searchInput">
            <button class="search-btn" onclick="performSearch()">Search</button>
            <button class="search-btn night-toggle" onclick="toggleNightMode()">Night</button>
        </div>
    </header>

    <div class="main-layout">
        <aside class="sidebar">
            <div class="category-section">
                <div class="category-title">Categories</div>
                <div class="category-list">
                    <ul>
                        {{/* All Posts - link_tit class for items without children */}}
                        <li>
                            <a href="{{ .Site.BaseURL }}posts/" class="link_tit">All ({{ len (where .Site.RegularPages "Section" "posts") }})</a>
                        </li>

                        {{/* Dynamic categories from data file */}}
                        {{ range .Site.Data.categories.categories }}
                        {{ if .expandable }}
                        {{/* Parents with children: link_item class (dimmer styling) */}}
                        <li>
                            <a href="{{ $.Site.BaseURL }}{{ strings.TrimPrefix "/" .url }}" class="link_item">{{ .name }}</a>
                            {{ if .children }}
                            <ul class="sub_category_list">
                                {{ range .children }}
                                <li>
                                    <a href="{{ $.Site.BaseURL }}{{ strings.TrimPrefix "/" .url }}" class="link_item link_sub_item">{{ .name }}</a>
                                </li>
                                {{ end }}
                            </ul>
                            {{ end }}
                        </li>
                        {{ else if ne .name "All" }}
                        {{/* Items without children: link_tit class */}}
                        <li>
                            <a href="{{ $.Site.BaseURL }}{{ strings.TrimPrefix "/" .url }}" class="link_tit">{{ .name }}</a>
                        </li>
                        {{ end }}
                        {{ end }}
                    </ul>
                </div>
            </div>
        </aside>

        <main class="content-area">
            {{ block "main" . }}{{ end }}
        </main>
    </div>

    <!-- Night Mode Notification -->
    <div id="nightModeNotification" class="night-mode-notification">
        Night mode activated
    </div>

    {{ $js := resources.Get "js/terminal.js" }}
    {{ if $js }}
    <script src="{{ $js.Permalink }}"></script>
    {{ end }}
</body>
</html>
